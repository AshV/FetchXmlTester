<!DOCTYPE html>
<html>
<head>
    <script src="js/codemirror.js" type="text/javascript"></script>
    <!-- HTML Meta Tags -->
    <title>Fetch Xml Tester Tool Online</title>
    <meta name="description" content="Test your fetchXml without need of providing your credentials. ">

    <!-- Google / Search Engine Tags -->
    <meta itemprop="name" content="Fetch Xml Tester Tool Online">
    <meta itemprop="description" content="Test your fetchXml without need of providing your credentials. ">
    <meta itemprop="image" content="https://github.com/AshV/FetchXmlTester/raw/master/logo.png">

    <!-- Facebook Meta Tags -->
    <meta property="og:url" content="https://www.ashishvishwakarma.com/FetchXmlTester">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Fetch Xml Tester Tool Online">
    <meta property="og:description" content="Test your fetchXml without need of providing your credentials. ">
    <meta property="og:image" content="https://github.com/AshV/FetchXmlTester/raw/master/logo.png">

    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Fetch Xml Tester Tool Online">
    <meta name="twitter:description" content="Test your fetchXml without need of providing your credentials. ">
    <meta name="twitter:image" content="https://github.com/AshV/FetchXmlTester/raw/master/logo.png">

    <!-- Meta Tags Generated via http://heymeta.com -->
    <meta name="keywords" content="fetchXML,Dynamics,CRM,365,CE,CX">
    <meta name="author" content="Ashish Vishwakarma">
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" type="text/css" href="styles/milligram.min.css" />
    <link rel="stylesheet" type="text/css" href="styles/style.css" />
    <link rel="stylesheet" type="text/css" href="styles/balloon.min.css" />
    <style type="text/css">
        .CodeMirror-line-numbers {
            width: 2.2em;
            color: #aaa;
            background-color: #eee;
            text-align: right;
            padding-right: .3em;
            font-size: 10pt;
            font-family: monospace;
            padding-top: .4em;
            line-height: normal;
        }
    </style>
</head>
<body>
    <div class="row" style="height:80%">
        <div class="column column-25" style="position:relative">
            <h2></h2>
            <h2>&lt;fetchXml<font color="#9b4dca">/</font>&gt;</h2>
            <h2>&lt;tester<font color="#9b4dca">/</font>&gt;</h2>
            <h2>&lt;online<font color="#9b4dca">/</font>&gt;</h2>
            <div style="bottom:0px; position:absolute;">
                <a href="https://www.ashishvishwakarma.com/posts/">Read my articles!</a>
                <br />
                <a href="https://www.ashishvishwakarma.com/test-fetchxml-with-webapi-dynamics-365-fetchxml-tester/">Help?</a>
                <br />
                <a class="github-button" href="https://github.com/AshV" data-size="large" data-show-count="true" aria-label="Follow @AshV on GitHub">Follow @AshV</a>
                <br />
                <a class="github-button" href="https://github.com/AshV/FetchXmlTester" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star AshV/FetchXmlTester on GitHub">Star</a>

                <br />
            </div>
        </div>
        <div class="column column-75" data-balloon="Paste your fetchXml here to test." data-balloon-pos="left">
            <div class="row">
                <div class="column column-20">
                    <input id="open" style="width:100%" class="button-small button-outline" value="Open File" type="submit" onclick="loadFile()" />
                </div>
                <div class="column column-60">
                    <input id="queryName" type="text" placeholder="What is this query for?" />
                </div>
                <div class="column column-20">
                    <input id="save" style="width:100%" class="button button-outline" value="Save As File" type="submit" />
                </div>
            </div>

            <textarea id="fetchXml" wrap="off" autofocus>&lt;fetch mapping=&apos;logical&apos;&gt;
   &lt;entity name=&apos;account&apos;&gt;
      &lt;attribute name=&apos;accountid&apos;/&gt;
      &lt;attribute name=&apos;name&apos;/&gt;
      &lt;link-entity name=&apos;systemuser&apos; to=&apos;owninguser&apos;&gt;
         &lt;filter type=&apos;and&apos;&gt;
            &lt;condition attribute=&apos;lastname&apos; operator=&apos;ne&apos; value=&apos;Cannon&apos; /&gt;
          &lt;/filter&gt;
      &lt;/link-entity&gt;
   &lt;/entity&gt;
&lt;/fetch&gt;  </textarea>
        </div>
    </div>
    </div>
    <div class="row">
        <div class="column column-80" data-balloon="Dynanics 365 Url which is currently logged-in in same browser session." data-balloon-pos="up">
            <input type="url" style="width:100%" class="btn" id="orgURL" placeholder="e.g https://OrganizationName.crm.dynamics.com" wrap="off"></input>
        </div>
        <div class="column column-20" data-balloon="Plural name of entity, please fill if not alredy populated. OR INVALID" data-balloon-pos="left">
            <input type="text" style="width:100%" class="btn" id="plural" placeholder="e.g. Entities" value="accounts" />
        </div>
    </div>
    <div class="row">
        <div class="column column-20" data-balloon="Generated Requested URI, Click o Copy!" data-balloon-pos="up">
            <input class="btn" id="requestURI" type="text" placeholder="generated request URI" data-clipboard-target="#requestURI" readonly />
        </div>
        <div class="column column-80">
            <input id="testButton" style="width:100%" class="btn" value="Test FetchXML and Generate Request URI" type="submit" />
            <br />
        </div>
    </div>
    <!--<div class="row">
        <div class="column">
            <textarea data-clipboard-target="#requestURI" style="height:75%"></textarea>
        </div>
        <div class="column">
            <textarea data-clipboard-target="#requestURI" style="height:70%"></textarea>
        </div>
    </div>-->
    <div class="row">
        <div style="bottom:0px; position:absolute;font-size:small;right:25px">
            <a target="_blank" id="finalURI" href="http://AshV.ml">|</a>  <b>FetchXml Tester Online</b> hosted with <font color="red">‚ù§</font> by <a href="https://github.com/AshV/FetchXmlTester">GitHub</a>
        </div>
    </div>
    <script src="js/script.js"></script>
    <script src="js/clipboard.min.js" type="text/javascript"></script>
    <script>new Clipboard('.btn');</script>
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <script>(function (i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () { (i[r].q = i[r].q || []).push(arguments) }, i[r].l = 1 * new Date(); a = s.createElement(o), m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m) })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga'); ga('create', 'UA-88171590-1', 'auto'); ga('send', 'pageview');</script>
    <script type="text/javascript">
        var editor = CodeMirror.fromTextArea('fetchXml', {
            height: "85%",
            parserfile: "parsexml.js",
            stylesheet: "css/xmlcolors.css",
            path: "js/",
            continuousScanning: 500,
            lineNumbers: true,
            onChange: function () {
                fetchXmlOnchange();
            }
        });
    </script>

    <input style="position: absolute; top: -100px;" type="file" id="file-input" accept="text/plain,text/xml" />
    <script>
        function loadFile() {
            document.getElementById('file-input').click();
        }
        function readSingleFile(e) {
            var file = e.target.files[0];
            if (!file) {
                return;
            }
            var reader = new FileReader();
            reader.onload = function (e) {
                var contents = e.target.result;
                displayContents(contents);
            };
            reader.readAsText(file);
        }

        function displayContents(contents) {
            debugger;
            editor.setCode(contents);
            var queryName = document.getElementById('file-input').value;
            queryName = queryName.substring(queryName.lastIndexOf('\\') + 1);
            document.getElementById('queryName').value = queryName;
            document.title = queryName;
        }

        document.getElementById('file-input').addEventListener('change', readSingleFile, false);
    </script>

</body>
</html>
